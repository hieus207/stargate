"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1566],{59346:function(e,t,n){n.d(t,{$g:function(){return r},LW:function(){return x},NE:function(){return O},Ob:function(){return b},RJ:function(){return i},j_:function(){return j}});var r,i,a=n(9866),o=n(38623),s=n(44230),c=n(79429),d=n(5532),u=n(35440),h=n(65720),f=n(41270),l=n(80417),p=n(87376).Buffer;async function m(e){let t=[];for(let n of e)try{let e=function(e){let t=e.startsWith("0x")?e.slice(2):e;return new Uint8Array(p.from(t,"hex"))}(n.publicKey);if(65!==e.length||4!==e[0])throw Error("Invalid public key format for node ".concat(n.nodeId));let r=await crypto.subtle.importKey("raw",e,{name:"ECDSA",namedCurve:"P-256"},!0,["verify"]);t.push({nodeId:n.nodeId,publicKey:r})}catch(e){throw console.error("Failed to process node ".concat(n.nodeId,":"),e),Error("Node processing failed: ".concat(e instanceof Error?e.message:"Unknown error"))}return t}async function y(e,t,n){try{let r=Uint8Array.from(atob(n),e=>e.charCodeAt(0));if(64!==r.length)return console.warn("Invalid signature length:",r.length),!1;return await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},e,r,t)}catch(e){return console.error("Signature verification failed:",e),!1}}async function g(e,t,n){try{let r=await m(n),i=0,a=[],o={};return await Promise.all(r.map(async n=>{try{if(!e[n.nodeId]){o[n.nodeId]=!1;return}let r=function(e,t){let n="".concat(e,":").concat(["user",t.coinType,t.destinationChain,(0,c.K)(t.destinationAddress),(0,c.K)(t.address)].join("-"));return new TextEncoder().encode(n)}(n.nodeId,t),a=await y(n.publicKey,r,e[n.nodeId]);o[n.nodeId]=a,a&&i++}catch(e){a.push("Verification failed for node ".concat(n.nodeId,": ").concat(e instanceof Error?e.message:"Unknown error")),o[n.nodeId]=!1}})),{success:i>=3,verifiedCount:i,errors:a.length>0?a:void 0,verificationDetails:o}}catch(e){return{success:!1,verifiedCount:0,errors:["Global verification error: ".concat(e instanceof Error?e.message:"Unknown error")],verificationDetails:{}}}}var w="hypercore-v2",b=class{async transfer(e){let t=await v(this.config,{dstAddress:e.dstAddress,srcChainKey:this.config.deposit.token.chainKey,dstChainKey:this.config.withdraw.token.chainKey}),n={...e,depositAddress:t};if(K(this.config,e))return this.depositFromLocalChain(n);if(C(this.config,e))return this.depositFromRemoteChain(n);throw Error("Unsupported transfer")}async getOptions(){return{options:[{mode:"taxi"}]}}async getDuration(e){return{estimated:void 0}}async getDepositFee(e){return 12n*await F(this.config)/10n}async getRoute(e){if(K(this.config,e)){A(this.config,e);let[t,n]=await Promise.all([this.getDuration(e),this.getDepositFee(e)]);return(0,a.Jg)(e,{route:w,messageFee:{zroFee:0n,nativeFee:0n},duration:t,srcAmountMax:o.Bz,allowance:o.Bz,srcAmount:e.srcAmount,dstAmount:(0,o.oO)(e.srcAmount-n,{from:this.config.deposit.token.decimals,to:this.config.withdraw.token.decimals,strict:!1})})}if(C(this.config,e)){A(this.config,e);let t=this.config.deposit.token,[n,r,i]=await Promise.all([this.getDuration(e),this.getDepositFee(e),this.stargateV2Bridge.getRoute({...e,dstChainKey:t.chainKey,dstToken:E(t)})]);if(i.error)throw i.error;let s=(0,o.oO)(i.dstAmount-r,{from:this.config.deposit.token.decimals,to:this.config.withdraw.token.decimals,strict:!1});return(0,a.Jg)(e,{...i,route:w,dstAmount:s,duration:n})}throw Error("Unsupported route")}supportsTransfer(e,t){return function(e,t,n){if(t.equals(n.withdraw.token)){let r={srcToken:E(e),dstToken:E(t),srcChainKey:e.chainKey,dstChainKey:t.chainKey};return K(n,r)||C(n,r)}return!1}(e,t,this.config)}async depositFromRemoteChain(e){var t,n;let r=this.config.deposit.token,i=(t=(0,o.oO)(e.dstAmountMin,{from:this.config.withdraw.token.decimals,to:r.decimals,strict:!1}))>(n=this.config.deposit.minAmount)?t:n,s=(0,a.BK)({...e,dstAddress:e.depositAddress,dstChainKey:r.chainKey,dstToken:E(r),dstAmountMin:i});return this.stargateV2Bridge.transfer(s)}async depositFromLocalChain(e){if(e.srcToken===T)return(0,u._X)({from:e.srcAddress,to:e.depositAddress,value:e.srcAmount},{chainKey:e.srcChainKey});throw Error("Token is not supported")}constructor(e,t,n){this.config=e,this.stargateV2Bridge=t,this.getViemClient=n}},k=f.z.object({address:f.z.string(),signatures:f.z.record(f.z.string()),status:f.z.literal("OK")});function E(e){return(0,o.gj)(e)?e.address:T}async function v(e,t){let{hyperunit:n,asset:r,guardianNodes:i}=e,{dstAddress:a,dstChainKey:o,srcChainKey:s}=t,c=I(s),d=I(o),u="".concat(n.apiUrl,"/gen/").concat(c,"/").concat(d,"/").concat(r,"/").concat(a),{data:f}=await h.Z.get(u),{address:l,signatures:p}=k.parse(f),m={destinationAddress:a,destinationChain:d,coinType:function(e){if("eth"===e)return"ethereum";throw Error("Unsupported asset: ".concat(e))}(r),address:l},y=await g(p,m,i);if(!y.success)throw Error("Error getting deposit address: signature verification failed",{cause:y});return l}function I(e){switch(e){case"sepolia":case"ethereum":return"ethereum";case"hypercore-testnet":case"hypercore":return"hyperliquid"}throw Error("Unsupported chain: ".concat(e))}function A(e,t){if(t.srcAmount<e.deposit.minAmount)throw Error("Amount is less than the minimum deposit amount");if(t.dstNativeAmount>0n)throw Error("Native drop is not supported")}function K(e,t){return t.srcChainKey===e.deposit.token.chainKey&&t.srcToken===E(e.deposit.token)&&t.dstChainKey===e.withdraw.token.chainKey&&t.dstToken===E(e.withdraw.token)}function C(e,t){var n,r;if(t.dstChainKey!==e.withdraw.token.chainKey||t.dstToken!==E(e.withdraw.token)||t.srcChainKey===e.deposit.token.chainKey||!(null===(n=e.stargate.deployments[e.deposit.token.chainKey])||void 0===n?void 0:n.token))return!1;let i=null===(r=e.stargate.deployments[t.srcChainKey])||void 0===r?void 0:r.token;return!!i&&E(i)===t.srcToken}var T="0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE";async function x(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{pollInterval:3e3};for(;;){try{let n=await U(e,t);if((null==n?void 0:n.state)==="done")return{srcTxHash:N(n.sourceTxHash),dstTxHash:N(n.destinationTxHash)}}catch(e){console.error(e)}await z(n.pollInterval)}}async function z(e){return new Promise(t=>setTimeout(t,e))}async function U(e,t){let{operations:n}=await q(e,t.dstAddress);return n.find(e=>e.sourceTxHash.startsWith(t.srcTxHash))}async function q(e,t){let{data:n}=await h.Z.get("".concat(e.hyperunit.apiUrl,"/operations/").concat(t));return H.parse(n)}var H=f.z.object({operations:f.z.object({operationId:f.z.string(),sourceTxHash:f.z.string(),destinationTxHash:f.z.string().optional(),state:f.z.string(),sourceChain:f.z.string()}).array()});function N(e){return null==e?void 0:e.split(":")[0]}async function F(e){return(await S(e)).ethereum["ethereum-depositFee"]}async function S(e){let{data:t}=await h.Z.get("".concat(e.hyperunit.apiUrl,"/estimate-fees"));return D.parse(t)}var D=f.z.object({ethereum:f.z.object({"ethereum-depositEta":f.z.string(),"ethereum-depositFee":f.z.bigint({coerce:!0}),"ethereum-withdrawalEta":f.z.string(),"ethereum-withdrawalFee":f.z.bigint({coerce:!0})})}),B=async e=>{let{destination:t,token:n,tokenId:r,amount:i,nonce:a,signature:o,chainId:s,hyperliquidApiUrl:c,hyperliquidChain:d}=e,u={action:{type:"spotSend",hyperliquidChain:d,signatureChainId:"0x".concat(s.toString(16)),destination:t,token:"".concat(n,":").concat(r),amount:i.toString(),time:a},nonce:a,signature:function(e){if(!e||"string"!=typeof e)throw Error("Invalid signature format");if(130!==(e=e.startsWith("0x")?e.slice(2):e).length)throw Error("Invalid signature length: ".concat(e.length,", expected 130"));let t=e.slice(-2);if("1c"!==t&&"1b"!==t&&"00"!==t&&"01"!==t)throw Error("Invalid signature v value: ".concat(t));let n="0x".concat(e.slice(0,64)),r="0x".concat(e.slice(64,128));if(!/^0x[0-9a-f]{64}$/i.test(n))throw Error("Invalid r component in signature");if(!/^0x[0-9a-f]{64}$/i.test(r))throw Error("Invalid s component in signature");return{r:n,s:r,v:"1b"===t||"00"===t?27:28}}(o)},{data:f}=await (0,h.Z)({method:"POST",baseURL:c,url:"/exchange",data:u});if("ok"!==f.status)throw Error(f.response);return f},O=class{async getOptions(e){return{options:[{mode:"taxi"}]}}async getRoute(e){let t=await S(this.config),n=t.ethereum["ethereum-withdrawalFee"],r=s(t.ethereum["ethereum-withdrawalEta"])/1e3,i=(0,o.oO)(e.srcAmount,{from:this.config.withdraw.token.decimals,to:this.config.deposit.token.decimals,strict:!1})-n;return(0,a.Jg)(e,{route:w,srcAmount:e.srcAmount,srcAmountMax:o.Bz,dstAmount:i>0n?i:0n,allowance:o.Bz,duration:{estimated:r},messageFee:{zroFee:0n,nativeFee:0n}})}async transfer(e){var t,n;let r=await v(this.config,e),{withdraw:i,deposit:a}=this.config;if(e.srcAmount<i.minAmount)throw Error("Insufficient amount: ".concat((0,d.b)(e.srcAmount,i.token.decimals),", min amount: ").concat((0,d.b)(i.minAmount,i.token.decimals)));let s=Date.now(),c={destination:r,token:i.token.symbol,tokenId:E(i.token),amount:(t=e.srcAmount,n=i.token,Number((0,d.b)(t,n.decimals))),nonce:s,chainId:a.chainId,hyperliquidChain:i.hyperliquidChain},u=function(e){let{destination:t,token:n,tokenId:r,amount:i,nonce:a,chainId:o,hyperliquidChain:s}=e;if(!t||"string"!=typeof t)throw Error("Invalid destination address");if(!n||"string"!=typeof n)throw Error("Invalid token");if(!r||"string"!=typeof r)throw Error("Invalid tokenId");if(null==i||Number.isNaN(i)||i<=0)throw Error("Invalid amount");if(!a||"number"!=typeof a||Number.isNaN(a))throw Error("Invalid nonce");if(!o||"number"!=typeof o||Number.isNaN(o))throw Error("Invalid chainId");return{types:{"HyperliquidTransaction:SpotSend":[{name:"hyperliquidChain",type:"string"},{name:"destination",type:"string"},{name:"token",type:"string"},{name:"amount",type:"string"},{name:"time",type:"uint64"}]},primaryType:"HyperliquidTransaction:SpotSend",domain:{name:"HyperliquidSignTransaction",version:"1",chainId:o,verifyingContract:"0x0000000000000000000000000000000000000000"},message:{destination:t,token:"".concat(n,":").concat(r),amount:i.toString(),time:a,hyperliquidChain:s}}}(c);return(0,o.$d)({action:R,signatures:[{signer:e.srcAddress,type:"eip712",typedData:u,chainKey:a.token.chainKey}],params:c})}supportsTransfer(e,t){return this.config.withdraw.token.equals(e)&&this.config.deposit.token.equals(t)}constructor(e){this.config=e}};function j(e){return{supports:e=>e.action===R,async send(t){let{signatures:n,params:r}=t,[i]=n;return await B({signature:i,destination:r.destination,token:r.token,tokenId:r.tokenId,amount:r.amount,nonce:r.nonce,chainId:r.chainId,hyperliquidChain:r.hyperliquidChain,hyperliquidApiUrl:e.hyperliquid.apiUrl}),{status:"success",receipt:{action:R,params:{nonce:r.nonce,destination:r.destination,hyperliquidChain:r.hyperliquidChain}}}},async track(t){let{receipt:n}=t,{nonce:r,destination:i}=n.params,{operations:a}=await q(e,i),o=function(e,t){let n=e.nonce.toString();return t.find(e=>e.operationId.split(":")[1]===n)}({nonce:r},a),s=[];return o?(o.destinationTxHash&&s.push({type:"transaction",txHash:o.destinationTxHash,chainKey:e.deposit.token.chainKey}),{status:"done"===o.state?"success":"pending",executionHistory:s}):{status:"unknown",executionHistory:s}}}}var R="hypercore-v2/withdraw";(r||(r={})).ETH={hyperunit:{apiUrl:"https://api.hyperunit-testnet.xyz"},hyperliquid:{apiUrl:"https://api.hyperliquid-testnet.xyz"},guardianNodes:[{nodeId:"node-1",publicKey:"04bab844e8620c4a1ec304df6284cd6fdffcde79b3330a7bffb1e4cecfee72d02a7c1f3a4415b253dc8d6ca2146db170e1617605cc8a4160f539890b8a24712152"},{nodeId:"hl-node-testnet",publicKey:"04502d20a0d8d8aaea9395eb46d50ad2d8278c1b3a3bcdc200d531253612be23f5f2e9709bf3a3a50d1447281fa81aca0bf2ac2a6a3cb8a12978381d73c24bb2d9"},{nodeId:"field-node",publicKey:"04e674a796ff01d6b74f4ee4079640729797538cdb4926ec333ce1bd18414ef7f22c1a142fd76dca120614045273f30338cd07d79bc99872c76151756aaec0f8e8"}],asset:"eth",stargate:l.Ys,withdraw:{hyperliquidChain:"Testnet",minAmount:50000000n,token:o.WU.from({chainKey:"hypercore-testnet",address:"0xe4371d8166f362d6578725f11e0a14f3",decimals:9,symbol:"UETH",name:"Unit Ethereum"})},deposit:{chainId:11155111,minAmount:0xb1a2bc2ec50000n,token:o.sN.from({chainKey:"sepolia",symbol:"ETH",name:"Ether",decimals:18})}},(i||(i={})).ETH={hyperunit:{apiUrl:"https://api.hyperunit.xyz"},hyperliquid:{apiUrl:"https://api.hyperliquid.xyz"},guardianNodes:[{nodeId:"unit-node",publicKey:"04dc6f89f921dc816aa69b687be1fcc3cc1d48912629abc2c9964e807422e1047e0435cb5ba0fa53cb9a57a9c610b4e872a0a2caedda78c4f85ebafcca93524061"},{nodeId:"hl-node",publicKey:"048633ea6ab7e40cdacf37d1340057e84bb9810de0687af78d031e9b07b65ad4ab379180ab55075f5c2ebb96dab30d2c2fab49d5635845327b6a3c27d20ba4755b"},{nodeId:"field-node",publicKey:"04ae2ab20787f816ea5d13f36c4c4f7e196e29e867086f3ce818abb73077a237f841b33ada5be71b83f4af29f333dedc5411ca4016bd52ab657db2896ef374ce99"}],asset:"eth",stargate:l.p4,withdraw:{hyperliquidChain:"Mainnet",minAmount:50000000n,token:o.WU.from({chainKey:"hypercore",address:"0xe1edd30daaf5caac3fe63569e24748da",decimals:9,symbol:"UETH",name:"Unit Ethereum"})},deposit:{chainId:1,minAmount:0xb1a2bc2ec50000n,token:o.sN.from({chainKey:"ethereum",symbol:"ETH",name:"Ether",decimals:18})}}}}]);